<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: html}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <th:block th:fragment="css">
        <link rel="stylesheet" th:href="@{/css/index.css}">
        <link rel="stylesheet" th:href="@{/css/message.css}">
    </th:block>
</head>
<body>
<th:block th:fragment="content">
    <div class="navbar">
        <div class="navbar-inner">
            <a href="/">ê²Œì‹œë¬¼</a>
            <a th:href="@{'/search'}">ê²€ìƒ‰</a>
            <a class="profile-src"
               onclick="ProfileBtn(event)"
               th:data-idx="${member != null} ? ${member.idx} : ''">
                í”„ë¡œí•„
            </a>
        </div>
    </div>
    <!-- ê²Œì‹œë¬¼ ì‘ì„±í•˜ê¸° -->
    <div class="post-create">
        <div  th:if="${#authorization.expression('isAuthenticated()')}">
            <form th:action="@{/board}" method="post" th:object="${board}" enctype="multipart/form-data">
                <div style="display: flex; align-items: center;">
                    <img class="profile-img" th:src="@{${'/profile-images/' + member.userImage}}" alt="í”„ë¡œí•„">
                    <div class="user-info" style="margin-left: 10px">
                        <span class="user-name" th:text="${member.userName}"></span>
                        <span class="user-id" th:text="${'@' +member.userId}"></span>
                    </div>
                </div>
                <div>
                    <input type="text" th:field="*{boardContent}" placeholder="ë¬´ì—‡ì„ ì‘ì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?">
                </div>

                <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìŠ¬ë¼ì´ë“œ -->
                <div class="image-slider">
                    <button type="button" class="slide-btn left">&#10094;</button>
                    <div class="preview-container" id="preview-container"></div>
                    <button type="button" class="slide-btn right">&#10095;</button>
                </div>

                <div class="buttons">
                    <input type="file" class="upload-btn" name="files"  onchange="preView(this);" multiple accept="image/*" />
                    <button class="file-btn" onclick="ImgUpload(event)">ì´ë¯¸ì§€ ì„ íƒ</button>
                    <button class="submit-btn">ì‘ì„± ì™„ë£Œ</button>
                </div>
            </form>
        </div>
        <div th:if="${#authorization.expression('isAnonymous()')}" class="login-message">
            <div style="display: flex; align-items: center;">
                <img class="profile-img" th:src="@{'/profile-images/' + basic.png}" alt="í”„ë¡œí•„">
            </div>
            <div>
                <input type="text"  placeholder="ë¡œê·¸ì¸ í›„ ì´ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤">
            </div>
            <a th:href="@{/login}">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™</a>
        </div>
    </div>

    <!-- ê²Œì‹œê¸€ ëª©ë¡ ë¦¬ìŠ¤íŠ¸ -->
    <div class="post" th:each="boards : ${boardList}">
        <div class="post-header">
            <a th:href="@{'/profile/' + ${writers[boards.boardIdx].idx}}">
                <img class="profile-img" th:src="@{'/profile-images/' + ${writers[boards.boardIdx].userImage}}" alt="í”„ë¡œí•„">
            </a>
            <div class="user-info">
                <span class="user-name" th:text="${writers[boards.boardIdx].userName}"></span>
                <span class="user-id" th:text="${'@' +writers[boards.boardIdx].userId}"></span>
            </div>
            <span class="time" th:data-time="${boards.boardAt}"></span>
        </div>
        <a class="boardDetail" th:href="@{${'/board/' + boards.boardIdx}}">
            <div class="post-content" th:text="${boards.boardContent}">
            </div>
            <div class="board-img-list">
                <div class="board-img-list-inner">
                    <button class="board-slide-left">&#10094;</button>
                    <div class="img-list-inner board-list" th:each="imgUrl : ${boardImages.get(boards.boardIdx)}">
                        <img th:src="@{${'/board-images/' + imgUrl}}" alt="ê²Œì‹œë¬¼ ì´ë¯¸ì§€">
                    </div>
                    <button class="board-slide-right">&#10095;</button>
                </div>
            </div>
        </a>
        <div class="post-actions">
            <span class="toggle-comments">ğŸ’¬ <span th:text="${boards.boardComent}"></span></span>
            <span>
                <span class="boardLike-btn" th:data-board-idx="${boards.boardIdx}">â¤ï¸</span>
                <span class="board-like-count" th:text="${boards.boardLike}"></span>
            </span>
            <span>ğŸ‘€ <span th:text="${boards.boardView}"></span></span>
        </div>

        <!--   ëŒ“ê¸€ ì°½ íŒì—…   -->
        <div class="comment-section"  th:attr="data-board-id=${boards.boardIdx}">
            <div class="comment-input" th:if="${#authorization.expression('isAuthenticated()')}">
                <img class="profile-img" th:src="@{${'/profile-images/' + member.userImage}}" alt="í”„ë¡œí•„">
                <div class="user-info">
                    <span class="user-name" th:text="${member.userName}"></span>
                    <span class="user-id" th:text="${'@' +member.userId}"></span>
                </div>
            </div>
            <form th:action="@{/comment}" method="post" th:object="${comment}" enctype="multipart/form-data">
                <input type="hidden" name="from" value="index">
                <div class="comment-font">
                    <input type="text" th:field="*{commentContent}" placeholder="ë¬´ì—‡ì„ ì‘ì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?">
                </div>

                <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìŠ¬ë¼ì´ë“œ -->
                <div class="image-slider comment-slider">
                    <button type="button" class="slide-btn left comment-left" >&#10094;</button>
                    <div class="preview-container comment-container" id="coment-container"></div>
                    <button type="button" class="slide-btn right comment-right">&#10095;</button>
                </div>

                <div class="comment-btn">
                    <input type="hidden" name="boardidx" th:value="${boards.boardIdx}">
                    <input type="file" class="upload-btn commentupload-btn"  name="commentfiles" onchange="preView(this);" multiple accept="image/*" />
                    <button class="file-btn" th:attr="data-board-id=${boards.boardIdx}" onclick="CommentImgUpload(event)">ì´ë¯¸ì§€ ì„ íƒ</button>
                    <button class="comment-submit">ì‘ì„±</button>
                </div>
            </form>
            <!--  ëŒ“ê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°   -->
            <div th:each="comment : ${commentList[boards.boardIdx]}" class="comment-bar">
                <div>
                    <div class="post-header">
                        <a th:href="@{${'/profile/' + commentwirtes[comment.commentIdx].idx}}">
                            <img class="profile-img" th:src="@{${'/profile-images/' + commentwirtes[comment.commentIdx].userImage}}" alt="í”„ë¡œí•„">
                        </a>
                        <div class="user-info">
                            <span class="user-name" th:text="${commentwirtes[comment.commentIdx].userName}"></span>
                            <span class="user-id" th:text="${'@' +commentwirtes[comment.commentIdx].userId}"></span>
                        </div>
                    </div>
                    <div class="comment-main">
                        <div class="post-content comment-content" th:text="${comment.commentContent}">
                        </div>
                        <div class="board-img-list comment-img-list">
                            <div class="board-img-list-inner comment-img-list-inner">
                                <button class="board-slide-left">&#10094;</button>
                                <div class="comment-img-list-inner-container">
                                    <div class="img-list-inner" th:each="imgUrl : ${commentImages.get(comment.commentIdx)}">
                                        <img th:src="@{${'/comment-images/' + imgUrl}}" alt="ê²Œì‹œë¬¼ ì´ë¯¸ì§€">
                                    </div>
                                </div>
                                <button class="board-slide-right">&#10095;</button>
                            </div>
                        </div>
                        <div class="post-actions">
                            <span class="toggle-comments">ğŸ’¬ <span th:text="${comment.commentRelay}"></span></span>
                            <span>
                                <span class="comment-like-btn" th:data-comment-idx="${comment.commentIdx}">â¤ï¸</span>
                                <span class="comment-like-count" th:text="${comment.commentLike}"></span>
                            </span>
                            <span>ğŸ‘€ <span th:text="${comment.commentView}"></span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="board-detail-src">
                <a th:href="@{${'/board/' + boards.boardIdx}}">ëŒ“ê¸€ ë”ë³´ê¸°</a>
            </div>
        </div>
    </div>
</th:block>
</body>
</html>
<script th:inline="javascript">

    // ì´ë¯¸ì§€ ìŠ¬ë¼ì´ ë²„íŠ¼ í´ë¦­ì‹œ a íƒœê·¸ë¡œ ê°€ëŠ” ì´ë™ ë§‰ê¸°
    document.querySelectorAll('.board-slide-left, .board-slide-right')
        .forEach(btn => {
            btn.addEventListener('click', function(event) {
                event.preventDefault();      // a íƒœê·¸ ì´ë™ ë§‰ê¸°
                event.stopPropagation();    // ë¶€ëª¨ ìš”ì†Œë¡œ ì´ë²¤íŠ¸ ì „íŒŒë„ ë§‰ê¸°

                // ìŠ¬ë¼ì´ë“œ ë¡œì§ ì‹¤í–‰
                console.log("ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ í´ë¦­!");
            });
        });

    // ëŒ“ê¸€ ì°½ ì—´ê¸° í† ê¸€
    document.addEventListener("DOMContentLoaded", function () {
        const commentToggles = document.querySelectorAll(".toggle-comments");

        const isLoggedIn = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;

        commentToggles.forEach(toggle => {
            toggle.addEventListener("click", function () {
                if(!isLoggedIn){
                    alert("ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”");
                    window.location.href = "/login";  // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    return;
                }
                const commentSection = this.closest(".post").querySelector(".comment-section");
                if (commentSection.style.display === "none" || commentSection.style.display === "") {
                    commentSection.style.display = "block";
                } else {
                    commentSection.style.display = "none";
                }
            });
        });
    });

    // í˜„ì¬ ì‹œê°„ì—ì„œ - ê²Œì‹¤ë¬¼ ì˜¬ë¦° ì‹œê°„ ë‚˜íƒ€ë‚´ê¸°
    document.addEventListener("DOMContentLoaded", function () {
        const timeElements = document.querySelectorAll(".time");

        timeElements.forEach(element => {
            const boardTime = new Date(element.getAttribute("data-time")); // ê²Œì‹œë¬¼ ì‹œê°„
            const now = new Date(); // í˜„ì¬ ì‹œê°„

            const diff = Math.floor((now - boardTime) / 1000); // ì´ˆ ë‹¨ìœ„ ì°¨ì´

            let timeAgo;
            if (diff < 60) {
                timeAgo = "ë°©ê¸ˆ ì „";
            } else if (diff < 3600) {
                timeAgo = Math.floor(diff / 60) + "ë¶„ ì „";
            } else if (diff < 86400) {
                timeAgo = Math.floor(diff / 3600) + "ì‹œê°„ ì „";
            } else if (diff < 604800) {
                timeAgo = Math.floor(diff / 86400) + "ì¼ ì „";
            } else {
                timeAgo = boardTime.toISOString().split("T")[0]; // 1ì£¼ ì´ìƒì´ë©´ ë‚ ì§œ í‘œì‹œ
            }

            element.textContent = timeAgo;
        });
    });

    // ê²Œì‹¤ë¬¼ ì´ë¯¸ì§€ ë²„íŠ¼
    function ImgUpload(event){
        event.preventDefault(); // ê¸°ë³¸ ì´ë²¤íŠ¸(í¼ ì œì¶œ) ë°©ì§€
        document.querySelector(".upload-btn").click();
    }

    // ëŒ“ê¸€ ì´ë¯¸ì§€ ë²„íŠ¼
    function CommentImgUpload(event) {
        event.preventDefault();

        const button = event.currentTarget; // ì´ë¯¸ì§€ ì„ íƒ ë²„íŠ¼ì„ í´ë¦­
        const boardId = button.dataset.boardId; // í´ë¦­í•œ ë²„íŠ¼ì˜ data ê°’ì„ ê°€ì ¸ì˜´

        // ë” ì•ˆì „í•˜ê²Œ: ë²„íŠ¼ ê¸°ì¤€ìœ¼ë¡œ ê°€ì¥ ê°€ê¹Œìš´ comment-section ì°¾ê¸°
        const commentSection = button.closest(".comment-section");// ë²„íŠ¼ ê¸°ì¤€ìœ¼ë¡œ ê°€ì¥ ê°€ê¹Œìš´ .comment-section ì°¾ê¸°

        const fileInput = commentSection.querySelector(".commentupload-btn"); // í•´ë‹¹ ì„¹ì…˜ ì•ˆì˜ input[type="file"] ì°¾ê¸°

        fileInput.dataset.boardId = boardId; // fileInputì— data ê°’ì„ ê°•ì œë¡œ ë„£ì–´ì¤Œ
        fileInput.click(); // input í´ë¦­í•´ì„œ íŒŒì¼ ì„ íƒì°½ ì—´ê¸°
    }

    // Profile í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°€ê¸°
    function ProfileBtn(event) {
        event.preventDefault(); // ê¸°ë³¸ ì´ë™ ë§‰ê¸°

        const isLoggedIn = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;

        if (!isLoggedIn) {
            alert("ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”");
            window.location.href = "/login"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        } else {
            const idx = event.currentTarget.getAttribute("data-idx");
            window.location.href = `/profile/${idx}`; // member.idx í¬í•¨í•´ì„œ ì´ë™
        }
    }

    // ê²Œì‹œë¬¼ preView ë° ëŒ“ê¸€ preView
    let postImages = [];  // ê²Œì‹œë¬¼ ì´ë¯¸ì§€ ë°°ì—´
    let commentImagesMap = {};  // key: boardId, value: ì´ë¯¸ì§€ ë°°ì—´

    // ê²Œì‹œë¬¼ ë° ëŒ“ê¸€ ì´ë¯¸ì§€ í”„ë¦¬ë·°
    function preView(input) {
        const isComment = input.classList.contains("commentupload-btn");
        const boardId = input.dataset.boardId;

        let previewContainer;
        if (isComment) {
            previewContainer = document.querySelector(`.comment-section[data-board-id="${boardId}"] .comment-container`);
            if (!commentImagesMap[boardId]) {
                commentImagesMap[boardId] = [];  // ì´ˆê¸°í™”
            }
        } else {
            previewContainer = document.getElementById("preview-container");
        }

        let images = isComment ? commentImagesMap[boardId] : postImages;

        if (input.files.length + images.length > 10) {
            alert("ìµœëŒ€ 10ì¥ê¹Œì§€ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            return;
        }

        Array.from(input.files).forEach((file) => {
            if (!file.type.startsWith("image/")) return;

            images.push(file);

            const reader = new FileReader();
            reader.onload = function (e) {
                const imgWrapper = document.createElement("div");
                imgWrapper.classList.add("preview-wrapper");

                const img = document.createElement("img");
                img.src = e.target.result;
                img.classList.add("preview-img");

                const closeBtn = document.createElement("span");
                closeBtn.classList.add("preview-close");
                closeBtn.textContent = "X";
                closeBtn.onclick = function () {
                    const currentIndex = images.indexOf(file);
                    removeImage(currentIndex, isComment, boardId); // âœ¨ boardId ë„˜ê¸°ê¸°
                };

                imgWrapper.appendChild(img);
                imgWrapper.appendChild(closeBtn);
                previewContainer.appendChild(imgWrapper);
                if(isComment){
                    initComentSlider();
                }else{
                    initBoardSlider();
                }
            };
            reader.readAsDataURL(file);
        });

        updateFileInput(isComment, boardId); // âœ¨ boardId ë„˜ê¸°ê¸°
    }


    // ê²Œì‹œë¬¼ ì´ë¯¸ì§€ ì‚­ì œ ë° ëŒ“ê¸€ ì´ë¯¸ì§€ ì‚­ì œ
    function removeImage(index, isComment, boardId = null) {
        let images = isComment ? commentImagesMap[boardId] : postImages;

        let previewContainer;
        if (isComment) {
            const commentSection = document.querySelector(`.comment-section[data-board-id="${boardId}"]`);
            previewContainer = commentSection.querySelector(".comment-container");
        } else {
            previewContainer = document.getElementById("preview-container");
        }

        images.splice(index, 1);

        const dataTransfer = new DataTransfer();
        images.forEach(file => dataTransfer.items.add(file));

        if (isComment) {
            const container = document.querySelector(`.comment-section[data-board-id="${boardId}"]`);
            const fileInput = container.querySelector(".commentupload-btn");
            fileInput.files = dataTransfer.files;
        } else {
            const fileInput = document.querySelector(".upload-btn");
            fileInput.files = dataTransfer.files;
        }

        // ë¯¸ë¦¬ë³´ê¸° ë‹¤ì‹œ ë Œë”ë§
        previewContainer.innerHTML = '';
        images.forEach((file) => {
            const reader = new FileReader();
            reader.onload = function (e) {
                const imgWrapper = document.createElement("div");
                imgWrapper.classList.add("preview-wrapper");

                const img = document.createElement("img");
                img.src = e.target.result;
                img.classList.add("preview-img");

                const closeBtn = document.createElement("span");
                closeBtn.classList.add("preview-close");
                closeBtn.textContent = "X";
                closeBtn.onclick = function () {
                    const currentIndex = images.indexOf(file);
                    removeImage(currentIndex, isComment, boardId);
                };

                imgWrapper.appendChild(img);
                imgWrapper.appendChild(closeBtn);
                previewContainer.appendChild(imgWrapper);
            };
            reader.readAsDataURL(file);
        });
    }


    //ì„ íƒí•œ ì´ë¯¸ì§€ë¥¼ inputì— ë„£ì–´ì¤Œ ê¸°ì¡´ íŒŒì¼ì„ ìœ ì§€í•´ì¤Œ
    function updateFileInput(isComment, boardId = null) {
        const dataTransfer = new DataTransfer();
        let images;

        if (isComment) {
            images = commentImagesMap[boardId] || [];
            const container = document.querySelector(`.comment-section[data-board-id="${boardId}"]`);
            const fileInput = container.querySelector(".commentupload-btn");
            images.forEach(file => dataTransfer.items.add(file));
            fileInput.files = dataTransfer.files;
        } else {
            images = postImages;
            const fileInput = document.querySelector(".upload-btn");
            images.forEach(file => dataTransfer.items.add(file));
            fileInput.files = dataTransfer.files;
        }
    }


    // ê²Œì‹œë¬¼ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ
    document.addEventListener("DOMContentLoaded", function () {
        const sliders = document.querySelectorAll(".board-img-list-inner");

        sliders.forEach(slider => {
            const imgContainer = slider.querySelectorAll(".board-list");
            const images = Array.from(imgContainer);
            const leftBtn = slider.querySelector(".board-slide-left");
            const rightBtn = slider.querySelector(".board-slide-right");
            let currentIndex = 0;
            const imgWidth = 285; // ì´ë¯¸ì§€ í¬ê¸° (275px + ì—¬ë°± 25px ê³ ë ¤)
            const maxIndex = images.length - 2; // âœ… ìµœëŒ€ ì´ë™ ê°€ëŠ¥ ì¸ë±ìŠ¤

            // ìŠ¬ë¼ì´ë“œ ì´ë™ í•¨ìˆ˜
            function updateSlide() {
                const offset = -(currentIndex * imgWidth);
                imgContainer.forEach(img => img.style.transform = `translateX(${offset}px)`);

                // ì™¼ìª½ ë²„íŠ¼ ì œì–´
                leftBtn.style.display = currentIndex > 0 ? 'block' : 'none';

                // ì˜¤ë¥¸ìª½ ë²„íŠ¼ ì œì–´
                rightBtn.style.display = currentIndex >= maxIndex ? 'none' : 'block';
            }

            // â¬…ï¸ ì™¼ìª½ ì´ë™
            leftBtn.addEventListener("click", function () {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateSlide();
                }
            });

            // â¡ï¸ ì˜¤ë¥¸ìª½ ì´ë™
            rightBtn.addEventListener("click", function () {
                if (currentIndex < maxIndex) {
                    currentIndex++;
                    updateSlide();
                }
            });

            // ì´ˆê¸° ìŠ¬ë¼ì´ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateSlide();
        });
    });

    // ê²Œì‹œê¸€ ì‘ì„± ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ
    function initBoardSlider() {
        const sliders = document.querySelector(".image-slider");
        const imgContainer = sliders.querySelector(".preview-container");
        const images = Array.from(imgContainer.querySelectorAll(".preview-wrapper"));
        const leftBtn = sliders.querySelector(".left");
        const rightBtn = sliders.querySelector(".right");
        const imgWidth = 285;
        let currentIndex = 0;

        const maxIndex = Math.max(images.length - 2, 0); // âœ… í•­ìƒ 0 ì´ìƒìœ¼ë¡œ

        function updateSlide() {
            const offset = -(currentIndex * imgWidth);
            imgContainer.style.transform = `translateX(${offset}px)`;

            leftBtn.style.display = currentIndex > 0 ? 'block' : 'none';
            rightBtn.style.display = currentIndex < maxIndex ? 'block' : 'none';
        }

        leftBtn.onclick = function () {
            if (currentIndex > 0) {
                currentIndex--;
                updateSlide();
            }
        };

        rightBtn.onclick = function () {
            if (currentIndex < maxIndex) {
                currentIndex++;
                updateSlide();
            }
        };

        updateSlide();
    }

    // ëŒ“ê¸€ ì‘ì„± ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ
    function initComentSlider() {
        const sliders = document.querySelectorAll(".comment-slider");

        sliders.forEach(slider => {
            const imgContainer = slider.querySelector(".comment-container");
            const images = Array.from(imgContainer.querySelectorAll(".preview-wrapper")); // â—ìŠ¬ë¼ì´ë“œí•  ì´ë¯¸ì§€ë“¤
            const leftBtn = slider.querySelector(".comment-left");
            const rightBtn = slider.querySelector(".comment-right");
            const imgWidth = 285;
            let currentIndex = 0;

            const maxIndex = Math.max(images.length - 2, 0); // âœ… í•­ìƒ 0 ì´ìƒìœ¼ë¡œ

            function updateSlide() {
                const offset = -(currentIndex * imgWidth);
                imgContainer.style.transform = `translateX(${offset}px)`;

                leftBtn.style.display = currentIndex > 0 ? 'block' : 'none';
                rightBtn.style.display = currentIndex < maxIndex ? 'block' : 'none';
            }

            leftBtn.onclick = function () {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateSlide();
                }
            };

            rightBtn.onclick = function () {
                if (currentIndex < maxIndex) {
                    currentIndex++;
                    updateSlide();
                }
            };

            updateSlide();
        });
    }

    // ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ
    document.addEventListener("DOMContentLoaded", function () {
        const sliders = document.querySelectorAll(".comment-img-list-inner");

        sliders.forEach(slider => {
            const imgContainer = slider.querySelector(".comment-img-list-inner-container");
            const images = slider.querySelectorAll(".img-list-inner");
            const leftBtn = slider.querySelector(".board-slide-left");
            const rightBtn = slider.querySelector(".board-slide-right");

            if (!imgContainer || images.length === 0) return;

            const imageWidth = 285; // ì´ë¯¸ì§€ 275 + ë§ˆì§„ í¬í•¨
            const moveStep = 275;   // ìŠ¬ë¼ì´ë“œ ì´ë™ í­
            const viewWidth = 456;  // ë³´ì—¬ì§€ëŠ” ì˜ì—­ í­

            const totalWidth = images.length * imageWidth;
            const maxTranslateX = totalWidth - viewWidth;

            const translatePositions = [];
            let currentX = 0;

            while (currentX + viewWidth < totalWidth) {
                translatePositions.push(currentX);
                currentX += moveStep;
            }

            // ë§ˆì§€ë§‰ ìœ„ì¹˜ ì¶”ê°€ (ëê¹Œì§€ ë³´ì´ê²Œ)
            if (translatePositions[translatePositions.length - 1] !== maxTranslateX) {
                translatePositions.push(maxTranslateX);
            }

            let currentIndex = 0;


            function updateSlide() {
                if (images.length > 1) {
                    const offset = -translatePositions[currentIndex];
                    imgContainer.style.transform = `translateX(${offset}px)`;
                } else {
                    imgContainer.style.transform = `translateX(0px)`;
                }
                leftBtn.style.display = currentIndex > 0 ? 'block' : 'none';
                rightBtn.style.display = currentIndex < translatePositions.length - 1 ? 'block' : 'none';
            }

            rightBtn.addEventListener("click", () => {
                if (currentIndex < translatePositions.length - 1) {
                    currentIndex++;
                    updateSlide();
                }
            });

            leftBtn.addEventListener("click", () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateSlide();
                }
            });

            updateSlide();
        });
    });


    // ê²Œì‹œë¬¼ ì°œí•˜ê¸° ê¸°ëŠ¥
    document.addEventListener("DOMContentLoaded",function (){
        const btns = document.querySelectorAll(".boardLike-btn");

        btns.forEach(btn => {
            const boardIdx = btn.dataset.boardIdx;
            const likeCountSpan = btn.parentElement.querySelector(".board-like-count");

               fetch(`/board/like-status/${boardIdx}`,{
                  method: "GET",
                  headers: {
                      "Content-Type" : "application/json"
                  }
               })
                   .then(response => response.json())
                   .then(data => {
                      if(data.status === "liked"){
                          btn.textContent = "â¤ï¸";
                          likeCountSpan.textContent = data.likeCount;
                      } else if(data.status === "not_liked"){
                          btn.textContent = "ğŸ–¤";
                          likeCountSpan.textContent = data.likeCount;
                      }
                   })
                   .catch(error => console.error("Error :", error));

               btn.addEventListener("click",function (){
                  fetch(`/board/like/${boardIdx}`, {
                     method: "POST",
                     headers: {
                         "Content-Type":"application/json"
                     }
                  })
                  .then(response => {
                      if(response.status === 401){
                          alert("ë¡œê·¸ì¸ì„ í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤");
                      }
                      return response.json();
                  })
                  .then(data => {
                     if(data.status === "added"){
                         btn.textContent = "â¤ï¸";
                         likeCountSpan.textContent = Number(likeCountSpan.textContent) + 1;
                     } else if(data.status === "removed"){
                         btn.textContent = "ğŸ–¤";
                         likeCountSpan.textContent = Number(likeCountSpan.textContent) - 1;
                     }
                  })
                  .catch(error => console.error("Error :", error));
            });
        });
    });

    // ëŒ“ê¸€ ì°œí•˜ê¸° ê¸°ëŠ¥
    document.addEventListener("DOMContentLoaded",function (){
        const btns = document.querySelectorAll(".comment-like-btn");

        btns.forEach(btn => {
            const commentIdx = btn.dataset.commentIdx;
            const likeCountSpan = btn.parentElement.querySelector(".comment-like-count");

            fetch(`/comment_like/status/${commentIdx}`,{
                method: "GET",
                headers: {
                    "Content-Type" : "application/json"
                }
            })
                .then(response => response.json())
                .then(data => {
                    if(data.status === "liked"){
                        btn.textContent = "â¤ï¸";
                        likeCountSpan.textContent = data.likeCount;
                    } else if(data.status === "not_liked"){
                        btn.textContent = "ğŸ–¤";
                        likeCountSpan.textContent = data.likeCount;
                    }
                })
                .catch(error => console.error("Error :", error));

            btn.addEventListener("click",function (){
                fetch(`/comment_like/${commentIdx}`, {
                    method: "POST",
                    headers: {
                        "Content-Type":"application/json"
                    }
                })
                    .then(response => {
                        if(response.status === 401){
                            alert("ë¡œê·¸ì¸ì„ í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤");
                        }
                        return response.json();
                    })
                    .then(data => {
                        if(data.status === "added"){
                            btn.textContent = "â¤ï¸";
                            likeCountSpan.textContent = Number(likeCountSpan.textContent) + 1;
                        } else if(data.status === "removed"){
                            btn.textContent = "ğŸ–¤";
                            likeCountSpan.textContent = Number(likeCountSpan.textContent) - 1;
                        }
                    })
                    .catch(error => console.error("Error :", error));
            });
        });
    });



    // íŒ”ë¡œìš° íŒ”ë¡œì‰ ì²´í¬í•˜ê¸°

</script>